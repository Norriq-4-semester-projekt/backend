<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>
  <body>
    <div style="max-width: 1000px; margin: 0 auto">
      <div id="chart"></div>
    </div>
    <script>
      fetch("http://40.127.205.41:5010/v1/SpikeDetection/GetGraphData")
        .then((response) => response.json())
        .then((data) => {
          var options = {
            chart: {
              type: "line",
            },
            series: [
              {
                name: "NetworkBytesOut",
                data: data
                  .filter((item) => item.FieldType == "NetworkBytesOut")
                  .map((item) => Math.round(item.Value / 10_000)),
              },
              {
                name: "NetworkBytesIn",
                data: data
                  .filter((item) => item.FieldType == "NetworkBytesIn")
                  .map((item) => Math.round(item.Value / 10_000)),
              },
              {
                name: "MemUsedInBytes",
                data: data
                  .filter((item) => item.FieldType == "MemUsedInBytes")
                  .map((item) => Math.round(item.Value / 100_000_000)),
              },
              {
                name: "SystemLoad",
                data: data
                  .filter((item) => item.FieldType == "SystemLoad")
                  .map((item) => Math.round(item.Value * 100)),
              },
              {
                name: "CpuPct",
                data: data
                  .filter((item) => item.FieldType == "CpuPct")
                  .map((item) => Math.round(item.Value * 100)),
              },
            ],
            xaxis: {
              type: "datetime",
              categories: data
                .filter((item) => item.FieldType == "MemUsedInBytes")
                .map((item) => new Date(item.Timestamp).getTime()),
            },
            // https://apexcharts.com/javascript-chart-demos/line-charts/line-chart-annotations/
            annotations: {
              points: data
                .filter(
                  (item) => item.FieldType == "MemUsedInBytes" && item.IsSpike
                )
                .map((item) => {
                  return {
                    x: new Date(item.Timestamp).getTime(),
                    y: Math.round(item.Value / 100_000_000),
                    marker: {
                      size: 4,
                      fillColor: "#fff",
                      strokeColor: "red",
                      radius: 2,
                      cssClass: "apexcharts-custom-class",
                    },
                  };
                })
                .concat(
                  data
                    .filter(
                      (item) =>
                        item.FieldType == "NetworkBytesIn" && item.IsSpike
                    )
                    .map((item) => {
                      return {
                        x: new Date(item.Timestamp).getTime(),
                        y: Math.round(item.Value / 10_000),
                        marker: {
                          size: 4,
                          fillColor: "#fff",
                          strokeColor: "red",
                          radius: 2,
                          cssClass: "apexcharts-custom-class",
                        },
                      };
                    })
                )
                .concat(
                  data
                    .filter(
                      (item) =>
                        item.FieldType == "NetworkBytesOut" && item.IsSpike
                    )
                    .map((item) => {
                      return {
                        x: new Date(item.Timestamp).getTime(),
                        y: Math.round(item.Value / 10_000),
                        marker: {
                          size: 4,
                          fillColor: "#fff",
                          strokeColor: "red",
                          radius: 2,
                          cssClass: "apexcharts-custom-class",
                        },
                      };
                    })
                )
                .concat(
                  data
                    .filter(
                      (item) =>
                        item.FieldType == "SystemLoad" && item.IsSpike
                    )
                    .map((item) => {
                      return {
                        x: new Date(item.Timestamp).getTime(),
                        y: Math.round(item.Value / 100),
                        marker: {
                          size: 4,
                          fillColor: "#fff",
                          strokeColor: "red",
                          radius: 2,
                          cssClass: "apexcharts-custom-class",
                        },
                      };
                    })
                ).concat(
                  data
                    .filter(
                      (item) =>
                        item.FieldType == "CpuPct" && item.IsSpike
                    )
                    .map((item) => {
                      return {
                        x: new Date(item.Timestamp).getTime(),
                        y: Math.round(item.Value / 100),
                        marker: {
                          size: 4,
                          fillColor: "#fff",
                          strokeColor: "red",
                          radius: 2,
                          cssClass: "apexcharts-custom-class",
                        },
                      };
                    })
                ),
            },
          };
          var chart = new ApexCharts(document.getElementById("chart"), options);
          chart.render();
        });
    </script>
  </body>
</html>
